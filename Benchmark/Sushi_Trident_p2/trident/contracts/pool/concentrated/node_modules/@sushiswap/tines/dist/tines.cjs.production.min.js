"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@ethersproject/bignumber");function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t}).apply(this,arguments)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function n(t,e,r){return(n=i()?Reflect.construct:function(t,e,r){var o=[null];o.push.apply(o,e);var i=new(Function.bind.apply(t,o));return r&&s(i,r.prototype),i}).apply(null,arguments)}function u(t){var e="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return n(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function a(t,e){!t()&&e&&console.error(e)}function c(t,e,r){return 0===r?t===e:t<1/r?Math.abs(t-e)<=10:Math.abs(t/e-1)<r}function h(t,e,r){void 0===r&&(r=1);try{if(e<=t(0))return 0;var o,s;if(t(r)>e){for(o=r/2;t(o)>e;)o/=2;s=2*o}else{for(s=2*r;t(s)<e;)s*=2;o=s/2}for(;s/o-1>1e-4;){var i=(o+s)/2,n=t(i);if(e===n)return i;e<n?s=i:o=i}return(o+s)/2}catch(t){return 0}}function v(e){if(e<Number.MAX_SAFE_INTEGER)return t.BigNumber.from(Math.round(e));var r=Math.floor(Math.log(e)/Math.LN2);console.assert(r>=51,"Internal Error 314");var o=r-51,s=Math.round(e/Math.pow(2,o));return t.BigNumber.from(s).mul(t.BigNumber.from(2).pow(o))}var p,d,f=function(t,e,r,o,s,i,n,u){void 0===n&&(n=1e3),void 0===u&&(u=4e4),this.address=t,this.token0=e,this.token1=r,this.fee=o,this.minLiquidity=n,this.swapGasCost=u,this.reserve0=s,this.reserve1=i},l=function(t){function e(e,r,o,s,i,n){return t.call(this,e,r,o,s,i,n)||this}r(e,t);var o=e.prototype;return o.calcOutByIn=function(t,e){var r=e?this.reserve1:this.reserve0,o=parseInt((e?this.reserve0:this.reserve1).toString());return[parseInt(r.toString())*t/(o/(1-this.fee)+t),this.swapGasCost]},o.calcInByOut=function(t,e){var r=e?this.reserve1:this.reserve0,o=parseInt((e?this.reserve0:this.reserve1).toString()),s=parseInt(r.toString()),i=o*t/(1-this.fee)/(s-t);return i<1&&(i=1),[i,this.swapGasCost]},o.calcPrice=function(t,e,r){var o=e?this.reserve1:this.reserve0,s=parseInt((e?this.reserve0:this.reserve1).toString()),i=parseInt(o.toString()),n=s/(r?1-this.fee:1);return i*n/(n+t)/(n+t)},o.calcInputByPrice=function(t,e,r){var o=e?this.reserve1:this.reserve0,s=parseInt((e?this.reserve0:this.reserve1).toString()),i=parseInt(o.toString()),n=s/(r?1-this.fee:1);return Math.sqrt(i*n*t)-n},e}(f),g=function(e){function o(r,o,s,i,n,u,a){var c;return(c=e.call(this,r,o,s,i,u,a)||this).A_PRECISION=100,c.A=n,c.D=t.BigNumber.from(0),c}r(o,e);var s=o.prototype;return s.computeLiquidity=function(){if(!this.D.eq(0))return this.D;var e=this.reserve0,r=this.reserve1;if(e.isZero()&&r.isZero())return t.BigNumber.from(0);for(var o,s=e.add(r),i=t.BigNumber.from(2*this.A),n=s,u=0;u<256;u++){var a=n.mul(n).div(e).mul(n).div(r).div(4);if(o=n,(n=i.mul(s).div(this.A_PRECISION).add(a.mul(2)).mul(n).div(i.div(this.A_PRECISION).sub(1).mul(n).add(a.mul(3)))).sub(o).abs().lte(1))break}return this.D=n,n},s.computeY=function(t){for(var e,r=this.computeLiquidity(),o=2*this.A,s=r.mul(r).div(t.mul(2)).mul(r).div(2*o/this.A_PRECISION),i=r.mul(this.A_PRECISION).div(o).add(t),n=r,u=0;u<256&&(e=n,!(n=n.mul(n).add(s).div(n.mul(2).add(i).sub(r))).sub(e).abs().lte(1));u++);return n},s.calcOutByIn=function(t,e){var r=e?this.reserve1:this.reserve0,o=(e?this.reserve0:this.reserve1).add(v(t*(1-this.fee))),s=this.computeY(o);return[parseInt(r.sub(s).toString()),this.swapGasCost]},s.calcInByOut=function(e,r){var o=r?this.reserve0:this.reserve1,s=(r?this.reserve1:this.reserve0).sub(v(e));s.lt(1)&&(s=t.BigNumber.from(1));var i=this.computeY(s),n=Math.round(parseInt(i.sub(o).toString())/(1-this.fee));return n<1&&(n=1),[n,this.swapGasCost]},s.calcPrice=function(t,e,r){var o=parseInt((e?this.reserve0:this.reserve1).toString()),s=r?1-this.fee:1,i=parseInt(this.computeLiquidity().toString()),n=this.A/this.A_PRECISION,u=o+t,a=4*n*u+i-4*n*i,c=i*i*i/u;return(.5-(2*a-c/u)/Math.sqrt(a*a+4*n*c)/4)*s},s.calcInputByPrice=function(t,e,r,o){var s=this;return void 0===o&&(o=1),h((function(t){return 1/s.calcPrice(t,e,r)}),t,o)},o}(f),m=function(){function t(t,e,r){this.pool=t,this.vert0=e,this.vert1=r,this.amountInPrevious=0,this.amountOutPrevious=0,this.canBeUsed=!0,this.direction=!0,this.spentGas=0,this.spentGasNew=0,this.bestEdgeIncome=0}var e=t.prototype;return e.reserve=function(t){return t===this.vert0?this.pool.reserve0:this.pool.reserve1},e.calcOutput=function(t,e){var r,o;if(t===this.vert1)if(this.direction)if(e<this.amountOutPrevious){var s=this.pool.calcInByOut(this.amountOutPrevious-e,!0);o=s[1],r=this.amountInPrevious-(r=s[0])}else{var i=this.pool.calcOutByIn(e-this.amountOutPrevious,!1);r=i[0],o=i[1],r+=this.amountInPrevious}else{var n=this.pool.calcOutByIn(this.amountOutPrevious+e,!1);r=n[0],o=n[1],r-=this.amountInPrevious}else if(this.direction){var u=this.pool.calcOutByIn(this.amountInPrevious+e,!0);r=u[0],o=u[1],r-=this.amountOutPrevious}else if(e<this.amountInPrevious){var a=this.pool.calcInByOut(this.amountInPrevious-e,!1);o=a[1],r=this.amountOutPrevious-(r=a[0])}else{var c=this.pool.calcOutByIn(e-this.amountInPrevious,!0);r=c[0],o=c[1],r+=this.amountOutPrevious}return[r,o-this.spentGas]},e.checkMinimalLiquidityExceededAfterSwap=function(t,e){if(t===this.vert0){var r=parseInt(this.pool.reserve1.toString());return this.direction?r-e-this.amountOutPrevious<this.pool.minLiquidity:r-e+this.amountOutPrevious<this.pool.minLiquidity}var o=parseInt(this.pool.reserve0.toString());return this.direction?o-e+this.amountInPrevious<this.pool.minLiquidity:o-e-this.amountInPrevious<this.pool.minLiquidity},e.testApply=function(t,e,r){console.assert(this.amountInPrevious*this.amountOutPrevious>=0);var o,s=this.direction?this.amountInPrevious:-this.amountInPrevious,i=this.direction?this.amountOutPrevious:-this.amountOutPrevious,n=0,u=0;if(t.getNeibour(this)){var a=s+(t===this.vert0?e:-r),h=i+(t===this.vert0?r:-e);a*h<0&&console.log("333"),console.assert(a*h>=0),a>=0?(o=!0,n=a,u=h):(o=!1,n=-a,u=-h)}else console.error("Error 221");if(o){var v=this.pool.calcOutByIn(n,!0)[0],p=c(u,v,1e-6);return p||console.log("Err 225-1 !!",u,v,Math.abs(v/u-1)),p}var d=this.pool.calcOutByIn(u,!1)[0],f=c(n,d,1e-6);return f||console.log("Err 225-2!!",n,d,Math.abs(d/n-1)),f},e.applySwap=function(t){var e=this;console.assert(this.amountInPrevious*this.amountOutPrevious>=0);var r=this.direction?this.amountInPrevious:-this.amountInPrevious,o=this.direction?this.amountOutPrevious:-this.amountOutPrevious,s=t.getNeibour(this);if(s){var i=r+(t===this.vert0?t.bestIncome:-s.bestIncome),n=o+(t===this.vert0?s.bestIncome:-t.bestIncome);console.assert(i*n>=0),i>=0?(this.direction=!0,this.amountInPrevious=i,this.amountOutPrevious=n):(this.direction=!1,this.amountInPrevious=-i,this.amountOutPrevious=-n)}else console.error("Error 221");this.spentGas=this.spentGasNew,a((function(){return e.direction?c(e.amountOutPrevious,e.pool.calcOutByIn(e.amountInPrevious,e.direction)[0],1e-6):c(e.amountInPrevious,e.pool.calcOutByIn(e.amountOutPrevious,e.direction)[0],1e-6)}),"Error 225")},t}(),y=function(){function t(t){this.token=t,this.edges=[],this.price=0,this.gasPrice=0,this.bestIncome=0,this.gasSpent=0,this.bestTotal=0,this.bestSource=void 0,this.checkLine=-1}return t.prototype.getNeibour=function(t){if(t)return t.vert0===this?t.vert1:t.vert0},t}(),P=function(){function t(t,e,r){var o=this;this.vertices=[],this.edges=[],this.tokens=new Map,t.forEach((function(t){var e=o.getOrCreateVertice(t.token0),r=o.getOrCreateVertice(t.token1),s=new m(t,e,r);e.edges.push(s),r.edges.push(s),o.edges.push(s)}));var s=this.tokens.get(e.address);s&&this.setPrices(s,1,r)}var e=t.prototype;return e.setPrices=function(t,e,r){var o=this;0===t.price&&(t.price=e,t.gasPrice=r,t.edges.map((function(e){return[e,parseInt(e.reserve(t).toString())]})).sort((function(t,e){return e[1]-t[1]})).forEach((function(s){var i=s[0],n=i.vert0===t?i.vert1:i.vert0;if(0===n.price){var u=i.pool.calcPrice(0,t===i.vert1,!1);o.setPrices(n,e*u,r/u)}})))},e.getOrCreateVertice=function(t){var e=this.tokens.get(t.address);return e||(e=new y(t),this.vertices.push(e),this.tokens.set(t.address,e),e)},e.findBestPath=function(t,e,r){var o=this.tokens.get(t.address),s=this.tokens.get(e.address);if(o&&s){this.edges.forEach((function(t){t.bestEdgeIncome=0,t.spentGasNew=0})),this.vertices.forEach((function(t){t.bestIncome=0,t.gasSpent=0,t.bestTotal=0,t.bestSource=void 0,t.checkLine=-1})),o.bestIncome=r,o.bestTotal=r;for(var i=new Set,n=[o],u=0,a=function(){var t=void 0,e=-1,r=0;if(n.forEach((function(o,s){o.bestTotal>e&&(e=o.bestTotal,t=o,r=s)})),!t)return{v:void 0};if(t.checkLine=u++,t===s){for(var o=[],a=s;null!=(c=a)&&c.bestSource;a=a.getNeibour(a.bestSource)){var c;o.unshift(a.bestSource)}return{v:{path:o,output:s.bestIncome,gasSpent:s.gasSpent,totalOutput:s.bestTotal}}}n.splice(r,1),t.edges.forEach((function(e){var r=t===e.vert0?e.vert1:e.vert0;if(!i.has(r)){var o,u;try{var a=e.calcOutput(t,t.bestIncome);o=a[0],u=a[1]}catch(e){return}if(e.checkMinimalLiquidityExceededAfterSwap(t,o))e.bestEdgeIncome=-1;else{var c=t.gasSpent+u,h=r.price/s.price,v=o*h-c*s.gasPrice;console.assert(0===e.bestEdgeIncome,"Error 373"),e.bestEdgeIncome=o*h,e.spentGasNew=e.spentGas+u,r.bestSource||n.push(r),(!r.bestSource||v>r.bestTotal)&&(r.bestIncome=o,r.gasSpent=c,r.bestTotal=v,r.bestSource=e)}}})),i.add(t)};;){var c=a();if("object"==typeof c)return c.v}}},e.addPath=function(t,e,r){var o=this,s=t;r.forEach((function(t){s?(t.applySwap(s),s=s.getNeibour(t)):console.error("Unexpected 315")})),a((function(){return o.vertices.every((function(r){var o=0,s=0;return r.edges.forEach((function(t){t.vert0===r?(t.direction?o-=t.amountInPrevious:o+=t.amountInPrevious,s+=t.amountInPrevious):(t.direction?o+=t.amountOutPrevious:o-=t.amountOutPrevious,s+=t.amountOutPrevious)})),r===t?o<=0:r===e?o>=0:0===s?0===o:Math.abs(o/s)<1e10}))}),"Error 290")},e.findBestRoute=function(t,e,r,o){var s=[];if(Array.isArray(o)){var i=o.reduce((function(t,e){return t+e}),0);s=o.map((function(t){return t/i}))}else for(var n=0;n<o;++n)s.push(1/o);this.edges.forEach((function(t){t.amountInPrevious=0,t.amountOutPrevious=0,t.direction=!0}));var u,a,c=0,h=0,v=0;for(u=0;u<s.length;++u){var p=this.findBestPath(t,e,r*s[u]);if(!p)break;c+=p.output,h+=p.gasSpent,this.addPath(this.tokens.get(t.address),this.tokens.get(e.address),p.path),v+=s[u]}if(0==u)return{status:exports.RouteStatus.NoWay,fromToken:t,toToken:e,amountIn:0,amountOut:0,legs:[],gasSpent:0,totalAmountOut:0};a=u<s.length?exports.RouteStatus.Partial:exports.RouteStatus.Success;var d=this.tokens.get(t.address),f=this.tokens.get(e.address),l=this.getRouteLegs(d,f),g=l[0],m=l[1],y=l[2];return console.assert(m<=h,"Internal Error 491"),y&&(c=this.calcLegsAmountOut(g,r,e)),{status:a,fromToken:t,toToken:e,amountIn:r*v,amountOut:c,legs:g,gasSpent:m,totalAmountOut:c-m*f.gasPrice}},e.getRouteLegs=function(t,e){var r=this,o=this.cleanTopology(t,e),s=o[1],i=[],n=0;return o[0].forEach((function(t){var e=r.getOutputEdges(t).map((function(t){var e=r.edgeFrom(t);return e?[t,e[0],e[1]]:[t]})),o=e.reduce((function(t,e){return t+e[2]}),0);if(!(o<=0)){var s=o;e.forEach((function(r,u){var a=r[2];i.push({address:r[0].pool.address,token:t.token,swapPortion:u+1===e.length?1:a/o,absolutePortion:a/s}),n+=r[0].pool.swapGasCost,o-=a})),console.assert(o/s<1e-12,"Error 281")}})),[i,n,s]},e.edgeFrom=function(t){if(0!==t.amountInPrevious)return t.direction?[t.vert0,t.amountInPrevious]:[t.vert1,t.amountOutPrevious]},e.getOutputEdges=function(t){return t.edges.filter((function(e){return!!e.canBeUsed&&0!==e.amountInPrevious&&e.direction===(e.vert0===t)}))},e.getInputEdges=function(t){return t.edges.filter((function(e){return!!e.canBeUsed&&0!==e.amountInPrevious&&e.direction!==(e.vert0===t)}))},e.calcLegsAmountOut=function(t,e,r){var o=this,s=new Map;return s.set(t[0].token.address,e),t.forEach((function(t){var e=o.tokens.get(t.token.address);console.assert(void 0!==e,"Internal Error 570");var r=e.edges.find((function(e){return e.pool.address===t.address}));console.assert(void 0!==r,"Internel Error 569");var i=r.pool,n=e===r.vert0,u=s.get(t.token.address);console.assert(void 0!==u,"Internal Error 564");var a=u*t.swapPortion;s.set(t.token.address,u-a);var c=i.calcOutByIn(a,n)[0],h=e.getNeibour(r),v=s.get(h.token.address);s.set(h.token.address,(v||0)+c)})),s.get(r.address)||0},e.cleanTopology=function(t,e){var r=!1,o=this.topologySort(t,e);if(2!==o[0]){for(r=!0,console.assert(0===o[0],"Internal Error 554");0===o[0];)this.removeWeakestEdge(o[1]),o=this.topologySort(t,e);if(3===o[0]&&(this.removeDeadEnds(o[1]),o=this.topologySort(t,e)),console.assert(2===o[0],"Internal Error 563"),2!==o[0])return[[],r]}return[o[1],r]},e.removeDeadEnds=function(t){var e=this;t.forEach((function(t){e.getInputEdges(t).forEach((function(t){t.canBeUsed=!1}))}))},e.removeWeakestEdge=function(t){var e,r,o=this,s=Number.MAX_VALUE;t.forEach((function(i,n){var u=0===n?t[t.length-1]:t[n-1],a=0;o.getOutputEdges(i).forEach((function(t){i.getNeibour(t)===u&&(a+=t.direction?t.amountOutPrevious:t.amountInPrevious)})),a<s&&(e=i,r=u,s=a)})),this.getOutputEdges(e).forEach((function(t){e.getNeibour(t)===r&&(t.canBeUsed=!1)}))},e.topologySort=function(t,e){var r=new Map,o=[],s=[],i=[],n=this,u=function t(u){var a=r.get(u);if(2===a||3===a)return a;if(1===a)return console.assert(0==s.length,"Internal Error 566"),s.push(u),1;r.set(u,1);for(var c=!1,h=n.getOutputEdges(u),v=0;v<h.length;++v){var p=t(u.getNeibour(h[v]));if(0===p)return 0;if(1===p)return s[0]===u?0:(s.push(u),1);2===p&&(c=!0)}return c?(console.assert(u!==e,"Internal Error 589"),o.push(u),r.set(u,2),2):u!==e?(i.push(u),r.set(u,3),3):(o.push(u),r.set(u,2),2)}(t);return 0===u?[0,s]:i.length?[3,i]:(a((function(){return o[0]===e&&o[o.length-1]===t}),"Internal Error 614"),2===u?[2,o.reverse()]:(console.assert(!0,"Internal Error 612"),[1,[]]))},t}();(p=exports.RouteStatus||(exports.RouteStatus={})).Success="Success",p.NoWay="NoWay",p.Partial="Partial",(d=exports.PoolType||(exports.PoolType={})).ConstantProduct="ConstantProduct",d.Weighted="Weighted",d.Hybrid="Hybrid",d.ConcentratedLiquidity="ConcentratedLiquidity";var I=function(t){var r=e({minLiquidity:1e3,swapGasCost:4e4},t);this.address=r.address,this.token0=r.token0,this.token1=r.token1,this.type=r.type,this.reserve0=r.reserve0,this.reserve1=r.reserve1,this.fee=r.fee,this.minLiquidity=r.minLiquidity,this.swapGasCost=r.swapGasCost},b=function(t){function o(r){return t.call(this,e({type:exports.PoolType.ConstantProduct},r))||this}return r(o,t),o}(I),O=function(t){function o(r){var o;return(o=t.call(this,e({type:exports.PoolType.Hybrid},r))||this).A=r.A,o}return r(o,t),o}(I),S=function(t){function o(r){var o;return(o=t.call(this,e({type:exports.PoolType.Weighted},r))||this).weight0=r.weight0,o.weight1=r.weight1,o}return r(o,t),o}(I),E=function(o){function s(r){var s;return(s=o.call(this,e({type:exports.PoolType.ConcentratedLiquidity,reserve0:t.BigNumber.from(0),reserve1:t.BigNumber.from(0)},r))||this).liquidity=r.liquidity,s.sqrtPrice=r.sqrtPrice,s.nearestTick=r.nearestTick,s.ticks=r.ticks,s}return r(s,o),s}(I),k=new Map;function w(e){var r=k.get(e);if(void 0!==r)return r;var o=e.reserve0,s=e.reserve1;if(o.isZero()&&s.isZero())return k.set(e,t.BigNumber.from(0)),t.BigNumber.from(0);for(var i,n=o.add(s),u=t.BigNumber.from(2*e.A),a=n,c=0;c<256;c++){var h=a.mul(a).div(o).mul(a).div(s).div(4);if(i=a,(a=u.mul(n).div(100).add(h.mul(2)).mul(a).div(u.div(100).sub(1).mul(a).add(h.mul(3)))).sub(i).abs().lte(1))break}return k.set(e,a),a}function x(t,e){for(var r,o=w(t),s=2*t.A,i=o.mul(o).div(e.mul(2)).mul(o).div(2*s/100),n=o.mul(100).div(s).add(e),u=o,a=0;a<256&&(r=u,!(u=u.mul(u).add(i).div(u.mul(2).add(n).sub(o))).sub(r).abs().lte(1));a++);return u}var B=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(u(Error));function q(t,e,r){void 0===r&&(r=!0);var o=parseInt(t.reserve0.toString()),s=parseInt(t.reserve1.toString()),i=r?1-t.fee:1;switch(t.type){case exports.PoolType.ConstantProduct:var n=o/i;return s*n/(n+e)/(n+e);case exports.PoolType.Weighted:var u=t.weight0/t.weight1,a=o+e*i;return s*u*i*Math.pow(o/a,u)/a;case exports.PoolType.Hybrid:var c=t,h=parseInt(w(c).toString()),v=c.A/100,p=o+e,d=4*v*p+h-4*v*h,f=h*h*h/p;return(.5-(2*d-f/p)/Math.sqrt(d*d+4*v*f)/4)*i}return 0}exports.ASSERT=a,exports.CL_MAX_TICK=887271,exports.CL_MIN_TICK=-887272,exports.ConstantProductRPool=l,exports.Edge=m,exports.Graph=P,exports.HybridComputeLiquidity=w,exports.HybridRPool=g,exports.HybridgetY=x,exports.OutOfLiquidity=B,exports.Pool=I,exports.RConcentratedLiquidityPool=E,exports.RConstantProductPool=b,exports.RHybridPool=O,exports.RPool=f,exports.RWeightedPool=S,exports.Vertice=y,exports.calcInByOut=function(e,r,o){var s=0,i=o?e.reserve0:e.reserve1,n=o?e.reserve1:e.reserve0;switch(e.type){case exports.PoolType.ConstantProduct:var u=parseInt(i.toString()),a=parseInt(n.toString());s=u*r/(1-e.fee)/(a-r);break;case exports.PoolType.Weighted:var c=parseInt(i.toString()),h=parseInt(n.toString());s=c*(1-e.fee)*(Math.pow(1-r/h,-(o?e.weight0/e.weight1:e.weight1/e.weight0))-1);break;case exports.PoolType.Hybrid:var p=n.sub(v(r));p.lt(1)&&(p=t.BigNumber.from(1));var d=x(e,p);s=Math.round(parseInt(d.sub(i).toString())/(1-e.fee));break;default:console.error("Unknown pool type")}return s<1&&(s=1),s},exports.calcInputByPrice=function(t,e,r){switch(void 0===r&&(r=1),t.type){case exports.PoolType.ConstantProduct:var o=parseInt(t.reserve0.toString()),s=parseInt(t.reserve1.toString()),i=o/(1-t.fee);return Math.sqrt(s*i*e)-i;case exports.PoolType.Weighted:return function(t,e){var r=parseInt(t.reserve0.toString()),o=parseInt(t.reserve1.toString()),s=t.weight0/t.weight1,i=o*e*s*(1-t.fee)*Math.pow(r,s);return(Math.pow(i,1/(s+1))-r)/(1-t.fee)}(t,e);case exports.PoolType.Hybrid:return h((function(e){return 1/q(t,e)}),e,r)}return 0},exports.calcOutByIn=function(t,e,r){void 0===r&&(r=!0);var o=r?t.reserve0:t.reserve1,s=r?t.reserve1:t.reserve0;switch(t.type){case exports.PoolType.ConstantProduct:var i=parseInt(o.toString());return parseInt(s.toString())*e/(i/(1-t.fee)+e);case exports.PoolType.Weighted:var n=parseInt(o.toString());return parseInt(s.toString())*(1-Math.pow(n/(n+e*(1-t.fee)),r?t.weight0/t.weight1:t.weight1/t.weight0));case exports.PoolType.Hybrid:var u=x(t,o.add(v(e*(1-t.fee))));return parseInt(s.sub(u).toString());case exports.PoolType.ConcentratedLiquidity:return function(t,e,r){if(0===t.ticks.length)return 0;t.ticks[0].index>-887272&&t.ticks.unshift({index:-887272,DLiquidity:0}),t.ticks[t.ticks.length-1].index<887271&&t.ticks.push({index:887271,DLiquidity:0});for(var o=r?t.nearestTick:t.nearestTick+1,s=t.sqrtPrice,i=t.liquidity,n=0,u=e;u>0;){if(o<0||o>=t.ticks.length)throw new B;var a=Math.sqrt(Math.pow(1.0001,t.ticks[o].index)),c=0;if(r){var h=i*(s-a)/s/a;u<=h?(c=i*s*u/(u+i/s),u=0):(c=i*(s-a),s=a,u-=h,t.ticks[o].index%2==0?i-=t.ticks[o].DLiquidity:i+=t.ticks[o].DLiquidity,o--)}else{var v=i*(a-s);u<=v?(c=u/s/(s+u/i),u=0):(c=i*(a-s)/s/a,s=a,u-=v,t.ticks[o].index%2==0?i+=t.ticks[o].DLiquidity:i-=t.ticks[o].DLiquidity,o++)}n+=c*(1-t.fee)}return n}(t,e,r)}},exports.calcPrice=q,exports.calcSquareEquation=function(t,e,r){var o=e*e-4*t*r;console.assert(o>=0,"Discriminant is negative! "+t+" "+e+" "+r);var s=Math.sqrt(o);return[(-e-s)/2/t,(-e+s)/2/t]},exports.closeValues=c,exports.findMultiRouting=function(t,e,r,o,s,i,n){void 0===n&&(n=12);var u=new P(o,s,i),a=u.tokens.get(t.address);return 0===(null==a?void 0:a.price)&&u.setPrices(a,1,0),u.findBestRoute(t,e,r,n)},exports.getBigNumber=v,exports.revertPositive=h;
//# sourceMappingURL=tines.cjs.production.min.js.map
